var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function a(t){let e;return c(t,(t=>e=t))(),e}function s(t,e,n){t.$$.on_destroy.push(c(e,n))}function l(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode&&t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function g(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function p(t){return document.createTextNode(t)}function v(){return p(" ")}function m(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function b(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t){return""===t?null:+t}function y(t,e){t.value=null==e?"":e}function x(t,e,n,o){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function $(t,e,n){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}n&&void 0===e||(t.selectedIndex=-1)}function k(t){const e=t.querySelector(":checked");return e&&e.__value}function _(t,e,n){t.classList[n?"add":"remove"](e)}let S;function O(t){S=t}function D(){if(!S)throw new Error("Function called outside component initialization");return S}function I(t){D().$$.on_mount.push(t)}function E(){const t=D();return(e,n,{cancelable:o=!1}={})=>{const i=t.$$.callbacks[e];if(i){const r=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,o,e),i}(e,n,{cancelable:o});return i.slice().forEach((e=>{e.call(t,r)})),!r.defaultPrevented}return!0}}const R=[],j=[];let C=[];const L=[],F=Promise.resolve();let B=!1;function W(t){C.push(t)}function A(t){L.push(t)}const M=new Set;let z=0;function N(){if(0!==z)return;const t=S;do{try{for(;z<R.length;){const t=R[z];z++,O(t),P(t.$$)}}catch(t){throw R.length=0,z=0,t}for(O(null),R.length=0,z=0;j.length;)j.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];M.has(e)||(M.add(e),e())}C.length=0}while(R.length);for(;L.length;)L.pop()();B=!1,M.clear(),O(t)}function P(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(W)}}const H=new Set;let T;function Y(t,e){t&&t.i&&(H.delete(t),t.i(e))}function J(t,e,n,o){if(t&&t.o){if(H.has(t))return;H.add(t),T.c.push((()=>{H.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}else o&&o()}function X(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function K(t){t&&t.c()}function V(t,n,r,c){const{fragment:a,after_update:s}=t.$$;a&&a.m(n,r),c||W((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),s.forEach(W)}function U(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];C.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),C=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function q(t,e){-1===t.$$.dirty[0]&&(R.push(t),B||(B=!0,F.then(N)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function G(e,i,r,c,a,s,l,u=[-1]){const f=S;O(e);const h=e.$$={fragment:null,ctx:[],props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(f?f.$$.context:[])),callbacks:n(),dirty:u,skip_bound:!1,root:i.target||f.$$.root};l&&l(h.root);let g=!1;if(h.ctx=r?r(e,i.props||{},((t,n,...o)=>{const i=o.length?o[0]:n;return h.ctx&&a(h.ctx[t],h.ctx[t]=i)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](i),g&&q(e,t)),n})):[],h.update(),g=!0,o(h.before_update),h.fragment=!!c&&c(h.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);h.fragment&&h.fragment.l(t),t.forEach(d)}else h.fragment&&h.fragment.c();i.intro&&Y(e.$$.fragment),V(e,i.target,i.anchor,i.customElement),N()}O(f)}class Q{$destroy(){U(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var Z;!function(t){t.Fit="fit",t.Fill="fill",t.Stretch="stretch"}(Z||(Z={}));const tt={[Z.Fill]:"Fill",[Z.Fit]:"Fit",[Z.Stretch]:"Stretch"},et=1,nt=5,ot=16;function it(t){const{monthIndex:e,year:n,canvas:o}=t,{boxSize:{value:i},calendarColor:{value:r="#ffffff"},backgroundImage:{value:c},backgroundRect:{value:a},calendarRect:{value:s},imageFitOption:{value:l}}=t.month,u=o.getContext("2d");u.clearRect(0,0,o.width,o.height),c&&function(t,e,n,o,i){switch(i){case Z.Fit:!function(t,e,n,o){const i=e.width/e.height,r=n/o;let c,a,s,l;r>i?(a=o,c=a*i,s=(n-c)/2,l=0):(c=n,a=c/i,s=0,l=(o-a)/2);t.drawImage(e,s,l,c,a)}(t,e,n,o);break;case Z.Fill:!function(t,e,n,o){const i=e.width/e.height,r=n/o;let c,a,s,l;r>i?(c=n,a=c/i,s=0,l=(o-a)/2):(a=o,c=a*i,s=(n-c)/2,l=0);t.drawImage(e,s,l,c,a)}(t,e,n,o);break;case Z.Stretch:!function(t,e,n,o){t.drawImage(e,0,0,n,o)}(t,e,n,o)}}(u,c,o.width,o.height,l);const d=Math.max(Math.min(.01*i.width,nt),et),f=ot;u.fillStyle=r,u.strokeStyle=r,u.textBaseline="middle",u.textAlign="center",u.shadowColor="black",u.shadowOffsetX=1,u.shadowOffsetY=0,u.shadowBlur=4,u.lineWidth=d;let h=new Date(n,e,1).getDay()-1;h=-1===h?6:h;const g=new Date(n,e+1,0).getDate();let p=1,v=0,m=0;const b=7*i.width,w=s.x;let y=s.y;const x=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],$=`${["January","February","March","April","May","June","July","August","September","October","November","December"][e]} - ${n}`;u.font=`bold ${f+4}px Arial`;const k=u.measureText($),_=w+b/2,S=k.fontBoundingBoxAscent+k.fontBoundingBoxDescent;u.fillText($,_,y+S),u.font=`bold ${f}px Arial`,y+=1.5*S;const O=S;for(let t=0;t<7;t++){const e=w+t*i.width;u.fillText(x[t],e+i.width/2,y+O)}y+=2*O,u.font=`${f}px Arial`;for(let t=0;t<6;t++){m=t*i.height+y;for(let e=0;e<7;e++)v=w+e*i.width,0===t&&e<h||p>g||(u.strokeRect(v,m,i.width,i.height),u.fillText(p.toString(),v+i.width/2,m+S),p++)}}const rt=[];function ct(e,n=t){let o;const i=new Set;function c(t){if(r(e,t)&&(e=t,o)){const t=!rt.length;for(const t of i)t[1](),rt.push(t,e);if(t){for(let t=0;t<rt.length;t+=2)rt[t][0](rt[t+1]);rt.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(r,a=t){const s=[r,a];return i.add(s),1===i.size&&(o=n(c)||t),r(e),()=>{i.delete(s),0===i.size&&o&&(o(),o=null)}}}}const at=["January","February","March","April","May","June","July","August","September","October","November","December"],st=Object.freeze({x:25,y:0,width:0,height:0,type:"calendar"});const lt=(t,e)=>e.some((e=>t instanceof e));let ut,dt;const ft=new WeakMap,ht=new WeakMap,gt=new WeakMap,pt=new WeakMap,vt=new WeakMap;let mt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return ht.get(t);if("objectStoreNames"===e)return t.objectStoreNames||gt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return yt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function bt(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(dt||(dt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(xt(this),e),yt(ft.get(this))}:function(...e){return yt(t.apply(xt(this),e))}:function(e,...n){const o=t.call(xt(this),e,...n);return gt.set(o,e.sort?e.sort():[e]),yt(o)}}function wt(t){return"function"==typeof t?bt(t):(t instanceof IDBTransaction&&function(t){if(ht.has(t))return;const e=new Promise(((e,n)=>{const o=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",r),t.removeEventListener("abort",r)},i=()=>{e(),o()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",i),t.addEventListener("error",r),t.addEventListener("abort",r)}));ht.set(t,e)}(t),lt(t,ut||(ut=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,mt):t)}function yt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const o=()=>{t.removeEventListener("success",i),t.removeEventListener("error",r)},i=()=>{e(yt(t.result)),o()},r=()=>{n(t.error),o()};t.addEventListener("success",i),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&ft.set(e,t)})).catch((()=>{})),vt.set(e,t),e}(t);if(pt.has(t))return pt.get(t);const e=wt(t);return e!==t&&(pt.set(t,e),vt.set(e,t)),e}const xt=t=>vt.get(t);const $t=["get","getKey","getAll","getAllKeys","count"],kt=["put","add","delete","clear"],_t=new Map;function St(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(_t.get(e))return _t.get(e);const n=e.replace(/FromIndex$/,""),o=e!==n,i=kt.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!i&&!$t.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,i?"readwrite":"readonly");let c=r.store;return o&&(c=c.index(e.shift())),(await Promise.all([c[n](...e),i&&r.done]))[0]};return _t.set(e,r),r}let Ot;async function Dt(){return Ot||(Ot=function(t,e,{blocked:n,upgrade:o,blocking:i,terminated:r}={}){const c=indexedDB.open(t,e),a=yt(c);return o&&c.addEventListener("upgradeneeded",(t=>{o(yt(c.result),t.oldVersion,t.newVersion,yt(c.transaction),t)})),n&&c.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("calendar-app-db",1,{upgrade(t){t.createObjectStore("images")}})),Ot}async function It(t,e){const n=`${t}_${e}`;return(await Dt()).transaction("images","readonly").store.get(n)}function Et(t,e){var n,o;if(!e)return;const i=null!==(o=null===(n=e.months)||void 0===n?void 0:n.map((t=>{const{backgroundImage:e}=t,n=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(t);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(n[o[i]]=t[o[i]])}return n}(t,["backgroundImage"]);return Object.assign(Object.assign({},n),{backgroundImage:Object.assign(Object.assign({},e),{value:null})})})))&&void 0!==o?o:[],r=Object.assign(Object.assign({},e),{months:i});localStorage.setItem(t,JSON.stringify(r)),Rt.set(r)}mt=(t=>({...t,get:(e,n,o)=>St(e,n)||t.get(e,n,o),has:(e,n)=>!!St(e,n)||t.has(e,n)}))(mt);const Rt=ct(void 0),jt=ct(),Ct=ct(void 0),Lt=ct(0),Ft=ct(0);const Bt=ct(Array(12).fill(null).map((()=>({backgroundImage:{value:null,isDirty:!1},backgroundRect:{value:{x:0,y:0,width:0,height:0,type:"background"},isDirty:!1},calendarRect:{value:Object.assign({},st),isDirty:!1},calendarColor:{value:"#ffffff",isDirty:!1},boxSize:{value:{width:100,height:100},isDirty:!1},imageFitOption:{value:Z.Fill,isDirty:!1}})))),Wt=ct((new Date).getMonth()),At=ct((new Date).getFullYear()),Mt=function(e,n,r){const a=!Array.isArray(e),s=a?[e]:e,l=n.length<2;return{subscribe:ct(r,(e=>{let r=!1;const u=[];let d=0,f=t;const h=()=>{if(d)return;f();const o=n(a?u[0]:u,e);l?e(o):f=i(o)?o:t},g=s.map(((t,e)=>c(t,(t=>{u[e]=t,d&=~(1<<e),r&&h()}),(()=>{d|=1<<e}))));return r=!0,h(),function(){o(g),f(),r=!1}})).subscribe}}([Bt,Wt],(([t,e])=>t[e]));function zt(t,e){const n=a(Wt);Bt.update((o=>{const i=o[n],r=a(At);i[t].value=e,i[t].isDirty=!0,Nt(t,e,r,n);for(let n=0;n<o.length;n++){const i=o[n];i[t].isDirty||(i[t].value=e,Nt(t,e,r,n))}const c=a(Rt);return c&&(c.months=o),Et(r.toString(),c),o}))}function Nt(t,e,n,o){"backgroundImage"===t&&async function(t,e,n){const o=await Dt(),i=await fetch(n.src),r=await i.blob(),c=`${t}_${e}`;console.log("trying to save",c);const a=o.transaction("images","readwrite");a.store.put(r,c),await a.done}(n,o,e)}function Pt(t){let e,n,i,r,c,a,s,f,p,w,y,$,k,S;return{c(){e=h("div"),n=h("div"),n.innerHTML='<span class="reset-icon svelte-1kklcfk">×</span>',i=v(),r=g("svg"),c=g("rect"),f=g("rect"),b(n,"class","reset-button svelte-1kklcfk"),_(n,"left-aligned",t[1]),_(n,"right-aligned",!t[1]),b(c,"class","dashed-main svelte-1kklcfk"),b(c,"x","0"),b(c,"y","0"),b(c,"width",a=t[0].width),b(c,"height",s=t[0].height),b(c,"stroke","white"),b(c,"stroke-width","2"),b(c,"fill","none"),b(f,"class","dashed-alternate svelte-1kklcfk"),b(f,"x","0"),b(f,"y","0"),b(f,"width",p=t[0].width),b(f,"height",w=t[0].height),b(f,"stroke","black"),b(f,"stroke-width","2"),b(f,"fill","none"),b(r,"xmlns","http://www.w3.org/2000/svg"),b(r,"width",y=t[0].width),b(r,"height",$=t[0].height),b(e,"class","bounding-box svelte-1kklcfk"),x(e,"left",t[0].x+"px"),x(e,"top",t[0].y+"px")},m(o,a){u(o,e,a),l(e,n),t[7](n),l(e,i),l(e,r),l(r,c),l(r,f),k||(S=[m(n,"pointerup",t[6]),m(e,"pointerdown",t[3]),m(e,"pointerup",t[5]),m(e,"pointermove",t[4])],k=!0)},p(t,o){2&o&&_(n,"left-aligned",t[1]),2&o&&_(n,"right-aligned",!t[1]),1&o&&a!==(a=t[0].width)&&b(c,"width",a),1&o&&s!==(s=t[0].height)&&b(c,"height",s),1&o&&p!==(p=t[0].width)&&b(f,"width",p),1&o&&w!==(w=t[0].height)&&b(f,"height",w),1&o&&y!==(y=t[0].width)&&b(r,"width",y),1&o&&$!==($=t[0].height)&&b(r,"height",$),1&o&&x(e,"left",t[0].x+"px"),1&o&&x(e,"top",t[0].y+"px")},d(n){n&&d(e),t[7](null),k=!1,o(S)}}}function Ht(e){let n,o=e[0]&&Pt(e);return{c(){o&&o.c(),n=p("")},m(t,e){o&&o.m(t,e),u(t,n,e)},p(t,[e]){t[0]?o?o.p(t,e):(o=Pt(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:t,o:t,d(t){o&&o.d(t),t&&d(n)}}}function Tt(t,e,n){const o=E();let{currentSelectedImage:i}=e;const r=Ct.subscribe((t=>{n(0,i=t)}));let c,a=0,s=0,l=!1,u=!1,d=!1;var f;return f=()=>{r()},D().$$.on_destroy.push(f),t.$$set=t=>{"currentSelectedImage"in t&&n(0,i=t.currentSelectedImage)},t.$$.update=()=>{1&t.$$.dirty&&n(1,d=i&&i.x+i.width>window.innerWidth)},[i,d,c,function(t){i&&(a=t.clientX,s=t.clientY,l=!0,u=!1)},function(t){if(!l)return;const e=t.clientX-a,o=t.clientY-s,r=Object.assign(Object.assign({},i),{x:i.x+e,y:i.y+o});n(0,i.x+=e,i),n(0,i.y+=o,i),a=t.clientX,s=t.clientY,0===e&&0===o||(u=!0),zt("calendar"===r.type?"calendarRect":"backgroundRect",r)},function(t){l=!1,(u||c.contains(t.target))&&t.stopPropagation(),u=!1},function(){n(0,i.x=0,i),n(0,i.y=0,i),o("imageMoved",i)},function(t){j[t?"unshift":"push"]((()=>{c=t,n(2,c)}))}]}class Yt extends Q{constructor(t){super(),G(this,t,Tt,Ht,r,{currentSelectedImage:0})}}function Jt(t,e,n=1){const o=new Date(t,e+1,0).getDate(),i=new Date(t,e,1).getDay()-n;return Math.ceil((o+i)/7)}function Xt(t,e,n,o=1){return t*(Jt(e,n,1)+1)}function Kt(e){let n,o,i;return{c(){n=h("div"),b(n,"class","resizer svelte-1kukuk1"),x(n,"left",e[0].x+e[0].width+"px"),x(n,"top",e[0].y+e[0].height+"px")},m(t,r){var c;u(t,n,r),o||(i=m(n,"pointerdown",(c=e[1],function(t){return t.stopPropagation(),c.call(this,t)})),o=!0)},p(t,[e]){1&e&&x(n,"left",t[0].x+t[0].width+"px"),1&e&&x(n,"top",t[0].y+t[0].height+"px")},i:t,o:t,d(t){t&&d(n),o=!1,i()}}}function Vt(t,e,n){let o,i,r;s(t,Wt,(t=>n(6,o=t))),s(t,At,(t=>n(7,i=t))),s(t,Mt,(t=>n(8,r=t)));let c,a,l,{imageRect:u}=e,d=!1;function f(t){if(!d)return;const e=t.clientX-c,n=t.clientY-a;zt("boxSize",{width:(7*l.width+e)/7,height:(Xt(l.height,i,o,1)+n)/(Jt(i,o,1)+1)})}function h(t){d=!1,window.removeEventListener("pointermove",f),window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",h)}return t.$$set=t=>{"imageRect"in t&&n(0,u=t.imageRect)},[u,function(t){d=!0,c=t.clientX,a=t.clientY,l={width:r.boxSize.value.width,height:r.boxSize.value.height},window.addEventListener("pointermove",f),window.addEventListener("pointerup",h),window.addEventListener("pointercancel",h)}]}class Ut extends Q{constructor(t){super(),G(this,t,Vt,Kt,r,{imageRect:0})}}function qt(t,e,n){const o=t.slice();return o[22]=e[n],o}function Gt(t,e,n){const o=t.slice();return o[25]=e[n],o[27]=n,o}function Qt(e){let n,o,i=e[25]+"";return{c(){n=h("option"),o=p(i),n.__value=e[27],n.value=n.__value},m(t,e){u(t,n,e),l(n,o)},p:t,d(t){t&&d(n)}}}function Zt(e){let n,o,i=tt[e[22]]+"";return{c(){n=h("option"),o=p(i),n.__value=e[22],n.value=n.__value},m(t,e){u(t,n,e),l(n,o)},p:t,d(t){t&&d(n)}}}function te(e){let n,i,r,c,a,s,g,k,_,S,O,D,I,E,R,j,C,L,F,B,A,M=at,z=[];for(let t=0;t<M.length;t+=1)z[t]=Qt(Gt(e,M,t));let N=Object.values(Z),P=[];for(let t=0;t<N.length;t+=1)P[t]=Zt(qt(e,N,t));return{c(){n=h("input"),i=v(),r=h("select");for(let t=0;t<z.length;t+=1)z[t].c();c=v(),a=h("label"),a.textContent="Calendar Width:",s=v(),g=h("input"),k=v(),_=h("label"),_.textContent="Calendar Height:",S=v(),O=h("input"),D=v(),I=h("label"),E=p("Color:\r\n  "),R=h("input"),j=v(),C=h("div"),L=v(),F=h("select");for(let t=0;t<P.length;t+=1)P[t].c();b(n,"type","file"),b(n,"accept","image/*"),void 0===e[4]&&W((()=>e[8].call(r))),b(a,"for","boxSizeWidth"),b(g,"id","boxSizeWidth"),b(g,"type","number"),b(g,"min","50"),b(_,"for","boxSizeHeight"),b(O,"id","boxSizeHeight"),b(O,"type","number"),b(O,"min","50"),b(R,"type","color"),b(R,"class","calendar-color-picker"),b(R,"id","calendar-color-picker"),b(C,"class","color-display"),x(C,"background-color",e[0]),x(C,"border-color",e[2]),b(I,"for","calendar-color-picker"),b(I,"class","color-picker-container"),void 0===e[3]&&W((()=>e[13].call(F)))},m(t,o){u(t,n,o),u(t,i,o),u(t,r,o);for(let t=0;t<z.length;t+=1)z[t]&&z[t].m(r,null);$(r,e[4],!0),u(t,c,o),u(t,a,o),u(t,s,o),u(t,g,o),y(g,e[1].width),u(t,k,o),u(t,_,o),u(t,S,o),u(t,O,o),y(O,e[1].height),u(t,D,o),u(t,I,o),l(I,E),l(I,R),y(R,e[0]),l(I,j),l(I,C),u(t,L,o),u(t,F,o);for(let t=0;t<P.length;t+=1)P[t]&&P[t].m(F,null);$(F,e[3],!0),B||(A=[m(n,"input",e[5]),m(r,"change",e[8]),m(g,"input",e[9]),m(g,"input",e[6]),m(O,"input",e[10]),m(O,"input",e[6]),m(R,"input",e[11]),m(R,"input",e[12]),m(F,"change",e[13]),m(F,"change",e[7])],B=!0)},p(t,[e]){if(0&e){let n;for(M=at,n=0;n<M.length;n+=1){const o=Gt(t,M,n);z[n]?z[n].p(o,e):(z[n]=Qt(o),z[n].c(),z[n].m(r,null))}for(;n<z.length;n+=1)z[n].d(1);z.length=M.length}if(16&e&&$(r,t[4]),2&e&&w(g.value)!==t[1].width&&y(g,t[1].width),2&e&&w(O.value)!==t[1].height&&y(O,t[1].height),1&e&&y(R,t[0]),1&e&&x(C,"background-color",t[0]),4&e&&x(C,"border-color",t[2]),0&e){let n;for(N=Object.values(Z),n=0;n<N.length;n+=1){const o=qt(t,N,n);P[n]?P[n].p(o,e):(P[n]=Zt(o),P[n].c(),P[n].m(F,null))}for(;n<P.length;n+=1)P[n].d(1);P.length=N.length}8&e&&$(F,t[3])},i:t,o:t,d(t){t&&d(n),t&&d(i),t&&d(r),f(z,t),t&&d(c),t&&d(a),t&&d(s),t&&d(g),t&&d(k),t&&d(_),t&&d(S),t&&d(O),t&&d(D),t&&d(I),t&&d(L),t&&d(F),f(P,t),B=!1,o(A)}}}function ee(t,e,n){let o,i,r,c,a;s(t,Wt,(t=>n(4,o=t))),s(t,At,(t=>n(15,i=t))),s(t,Mt,(t=>n(16,r=t))),s(t,Ft,(t=>n(17,c=t))),s(t,Lt,(t=>n(18,a=t)));let l,u={width:100,height:100},d="#FFFFFF",f="",h=Z.Fill;function g(t){n(0,d=t.calendarColor.value),n(1,u=Object.assign({},t.boxSize.value)),l=t.backgroundImage.value,n(3,h=t.imageFitOption.value)}function p(){const t=r.calendarRect.value;t.width=7*u.width,t.height=Xt(u.height,i,o,1),zt("calendarRect",Object.assign({},t))}I((()=>{g(r);let t=r;const e=[Mt.subscribe((()=>{t!==r&&g(r),t=r}))];return p(),()=>{e.forEach((t=>t()))}}));return t.$$.update=()=>{1&t.$$.dirty&&n(2,f=function(t){const e=parseInt(t.replace("#",""),16);return.2126*(e>>16&255)+.7152*(e>>8&255)+.0722*(e>>0&255)<32}(d)?"transparent":"black")},[d,u,f,h,o,function(t){const e=t.target.files[0],n=new FileReader;n.onload=t=>{l=new Image,l.src=t.target.result,l.onload=()=>(zt("backgroundImage",l),jt.set(l),void zt("backgroundRect",Object.assign(Object.assign({},r.backgroundRect.value),{width:a,height:c})))},n.readAsDataURL(e)},function(){zt("boxSize",Object.assign({},u)),p()},function(){zt("imageFitOption",h)},function(){o=k(this),Wt.set(o)},function(){u.width=w(this.value),n(1,u)},function(){u.height=w(this.value),n(1,u)},function(){d=this.value,n(0,d)},()=>zt("calendarColor",d),function(){h=k(this),n(3,h)}]}class ne extends Q{constructor(t){super(),G(this,t,ee,te,r,{})}}function oe(t){let e,n,o;function i(e){t[21](e)}let r={};return void 0!==t[1]&&(r.imageRect=t[1]),e=new Ut({props:r}),j.push((()=>X(e,"imageRect",i))),{c(){K(e.$$.fragment)},m(t,n){V(e,t,n),o=!0},p(t,o){const i={};!n&&2&o&&(n=!0,i.imageRect=t[1],A((()=>n=!1))),e.$set(i)},i(t){o||(Y(e.$$.fragment,t),o=!0)},o(t){J(e.$$.fragment,t),o=!1},d(t){U(e,t)}}}function ie(t){let e,n,i,r,c,a,s,f,g,p,x,k,_,S,O,D,I,E,R,C,L,F,B,M,z,N,P,H,q,G,Q,Z,tt,et,nt,ot,it,rt,ct,at,st;function lt(e){t[19](e)}Q=new ne({});let ut={};void 0!==t[1]&&(ut.currentSelectedImage=t[1]),et=new Yt({props:ut}),j.push((()=>X(et,"currentSelectedImage",lt))),et.$on("imageMoved",t[20]);let dt="calendar"===t[1]?.type&&oe(t);return{c(){e=h("div"),n=h("input"),i=v(),r=h("button"),r.textContent="Export Calendar",c=v(),a=h("button"),a.textContent="Export Year",s=v(),f=h("div"),g=h("label"),g.textContent="Canvas Width:",p=v(),x=h("input"),k=v(),_=h("label"),_.textContent="Canvas Height:",S=v(),O=h("input"),D=v(),I=h("select"),E=h("option"),E.textContent="Fit to background image",R=h("option"),R.textContent="800x600",C=h("option"),C.textContent="1024x768",L=h("option"),L.textContent="1280x720 (720p)",F=h("option"),F.textContent="1920x1080 (1080p)",B=h("option"),B.textContent="2560x1440 (1440p)",M=h("option"),M.textContent="3840x2160 (4K)",z=h("option"),z.textContent="5120x2880 (5K)",N=h("option"),N.textContent="7680x4320 (8K)",P=v(),H=h("button"),H.textContent="Reset Rects",q=v(),G=h("div"),K(Q.$$.fragment),Z=v(),tt=h("div"),K(et.$$.fragment),ot=v(),dt&&dt.c(),it=v(),rt=h("canvas"),b(n,"type","number"),b(n,"min","1"),b(e,"class","settings svelte-1liei12"),b(g,"for","canvasWidth"),b(x,"id","canvasWidth"),b(x,"type","number"),b(x,"min","300"),b(_,"for","canvasHeight"),b(O,"id","canvasHeight"),b(O,"type","number"),b(O,"min","300"),E.__value="auto",E.value=E.__value,R.__value="800x600",R.value=R.__value,C.__value="1024x768",C.value=C.__value,L.__value="1280x720",L.value=L.__value,F.__value="1920x1080",F.value=F.__value,B.__value="2560x1440",B.value=B.__value,M.__value="3840x2160",M.value=M.__value,z.__value="5120x2880",z.value=z.__value,N.__value="7680x4320",N.value=N.__value,void 0===t[0]&&W((()=>t[17].call(I))),b(f,"class","settings svelte-1liei12"),b(G,"class","settings svelte-1liei12"),b(rt,"width",t[4]),b(rt,"height",t[5]),b(rt,"class","svelte-1liei12"),b(tt,"class","canvas-container svelte-1liei12")},m(o,d){u(o,e,d),l(e,n),y(n,t[2]),l(e,i),l(e,r),l(e,c),l(e,a),u(o,s,d),u(o,f,d),l(f,g),l(f,p),l(f,x),y(x,t[4]),l(f,k),l(f,_),l(f,S),l(f,O),y(O,t[5]),l(f,D),l(f,I),l(I,E),l(I,R),l(I,C),l(I,L),l(I,F),l(I,B),l(I,M),l(I,z),l(I,N),$(I,t[0],!0),l(f,P),l(f,H),u(o,q,d),u(o,G,d),V(Q,G,null),u(o,Z,d),u(o,tt,d),V(et,tt,null),l(tt,ot),dt&&dt.m(tt,null),l(tt,it),l(tt,rt),t[22](rt),ct=!0,at||(st=[m(n,"input",t[12]),m(r,"click",t[7]),m(a,"click",t[8]),m(x,"input",t[13]),m(x,"input",t[14]),m(O,"input",t[15]),m(O,"input",t[16]),m(I,"change",t[17]),m(I,"change",t[18]),m(H,"click",t[10])],at=!0)},p(t,[e]){4&e&&w(n.value)!==t[2]&&y(n,t[2]),16&e&&w(x.value)!==t[4]&&y(x,t[4]),32&e&&w(O.value)!==t[5]&&y(O,t[5]),1&e&&$(I,t[0]);const i={};!nt&&2&e&&(nt=!0,i.currentSelectedImage=t[1],A((()=>nt=!1))),et.$set(i),"calendar"===t[1]?.type?dt?(dt.p(t,e),2&e&&Y(dt,1)):(dt=oe(t),dt.c(),Y(dt,1),dt.m(tt,it)):dt&&(T={r:0,c:[],p:T},J(dt,1,1,(()=>{dt=null})),T.r||o(T.c),T=T.p),(!ct||16&e)&&b(rt,"width",t[4]),(!ct||32&e)&&b(rt,"height",t[5])},i(t){ct||(Y(Q.$$.fragment,t),Y(et.$$.fragment,t),Y(dt),ct=!0)},o(t){J(Q.$$.fragment,t),J(et.$$.fragment,t),J(dt),ct=!1},d(n){n&&d(e),n&&d(s),n&&d(f),n&&d(q),n&&d(G),U(Q),n&&d(Z),n&&d(tt),U(et),dt&&dt.d(),t[22](null),at=!1,o(st)}}}function re(t,e,n){let o,i,r,c,a,l,u,d;s(t,Mt,(t=>n(24,o=t))),s(t,Lt,(t=>n(4,i=t))),s(t,Ft,(t=>n(5,r=t))),s(t,Bt,(t=>n(25,c=t))),s(t,At,(t=>n(2,a=t))),s(t,Wt,(t=>n(26,l=t))),s(t,Rt,(t=>n(11,u=t)));let f,h="auto",g=!1;function p(){g||(g=!0,requestAnimationFrame((()=>{0!==i&&0!==r&&it({monthIndex:l,year:a,month:o,canvas:d,firstDayOfWeek:1,locale:"en-GB"}),g=!1})))}function v(){p()}function m(){if("auto"===h){const t=o.backgroundImage.value;t&&(Lt.set(t.naturalWidth),Ft.set(t.naturalHeight))}else{const[t,e]=h.split("x").map(Number);Lt.set(t),Ft.set(e)}}function b(t){const e=d.getBoundingClientRect(),i=o.calendarRect.value,r=o.backgroundRect.value,c=t.pageX-e.left-window.scrollX,a=t.pageY-e.top-window.scrollY;c<0||c>e.width||a<0||a>e.height?n(1,f=void 0):c>=i.x&&c<=i.x+i.width&&a>=i.y&&a<=i.y+i.height?n(1,f=i):c>=r.x&&c<=r.x+r.width&&a>=r.y&&a<=r.y+r.height?n(1,f=r):n(1,f=void 0)}I((()=>{let t=function(t){const e=localStorage.getItem(t);return e?JSON.parse(e):null}(a.toString());t?Bt.set(t.months):(t={canvasHeight:r,canvasWidth:i,selectedResolution:h,months:c},Et(a.toString(),t)),Rt.set(t),Lt.set(u.canvasWidth),Ft.set(u.canvasHeight),n(0,h=u.selectedResolution);const e=[At.subscribe((()=>v())),Mt.subscribe((()=>{v(),function(){if(!f)return void Ct.set(f);let t="background"===f.type?o.backgroundRect.value:o.calendarRect.value;n(1,f=t),Ct.set(f)}()})),jt.subscribe((()=>m())),Lt.subscribe((()=>{const t=o.backgroundRect.value;t.width=i;const e=u,n=Object.assign(Object.assign({},e),{canvasWidth:i});Et(a.toString(),n),zt("backgroundRect",t),p()})),Ft.subscribe((()=>{const t=o.backgroundRect.value;t.height=r;const e=u,n=Object.assign(Object.assign({},e),{canvasHeight:r});Et(a.toString(),n),zt("backgroundRect",t),p()}))];return Wt.set((new Date).getMonth()),async function(t,e,n){if(e)for(let o=0;o<e.months.length;o++){const e=await It(t.toString(),o.toString());if(!e)continue;const i=new Image;i.onload=()=>{n.update((t=>(t[o].backgroundImage.value=i,t)))},i.src=URL.createObjectURL(e)}}(a,t,Bt).then((()=>p())),p(),window.addEventListener("pointerup",b),()=>{e.forEach((t=>t())),window.removeEventListener("pointerup",b)}}));return t.$$.update=()=>{if(2&t.$$.dirty&&f&&Ct.set(f),2053&t.$$.dirty&&u){const t=u,e=Object.assign(Object.assign({},t),{selectedResolution:h});Et(a.toString(),e)}},[h,f,a,d,i,r,p,function(){const t=d.toDataURL("image/png"),e=document.createElement("a");e.href=t;const n=`${At}_${at[Wt]}.png`;e.download=n,e.click()},function(){const t=function(t){const{year:e,months:n,firstDayOfWeek:o,cellWidth:i,cellHeight:r,cellSpacing:c}=t,a=document.createElement("canvas");a.width=3*i+2*c,a.height=4*r+3*c;const s=a.getContext("2d"),l=document.createElement("canvas");l.width=i,l.height=r;for(let t=0;t<4;t++)for(let a=0;a<3;a++){const u=3*t+a;it({monthIndex:u,month:n[u],year:e,canvas:l,firstDayOfWeek:o});const d=a*(i+c),f=t*(r+c);s.drawImage(l,d,f,i,r)}return a}({year:a,months:c,firstDayOfWeek:1,cellHeight:r,cellWidth:i,cellSpacing:5}),e=t.toDataURL("image/png"),n=document.createElement("a");n.href=e,n.download=`calendar-${At}.png`,n.click()},m,function(){const t=o.calendarRect.value,e=o.backgroundRect.value;t.x=st.x,t.y=st.y,e.x=0,e.y=0,zt("calendarRect",t),zt("backgroundRect",e),p()},u,function(){a=w(this.value),At.set(a)},function(){i=w(this.value),Lt.set(i)},()=>p(),function(){r=w(this.value),Ft.set(r)},()=>p(),function(){h=k(this),n(0,h)},()=>m(),function(t){f=t,n(1,f)},()=>{p()},function(t){f=t,n(1,f)},function(t){j[t?"unshift":"push"]((()=>{d=t,n(3,d)}))}]}class ce extends Q{constructor(t){super(),G(this,t,re,ie,r,{})}}function ae(e){let n,o,i;return o=new ce({}),{c(){n=h("main"),K(o.$$.fragment)},m(t,e){u(t,n,e),V(o,n,null),i=!0},p:t,i(t){i||(Y(o.$$.fragment,t),i=!0)},o(t){J(o.$$.fragment,t),i=!1},d(t){t&&d(n),U(o)}}}return new class extends Q{constructor(t){super(),G(this,t,null,ae,r,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
